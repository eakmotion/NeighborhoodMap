function getWikiInfo(a){var e="https://en.wikipedia.org/w/api.php?action=opensearch&search="+a.name+"&format=json&callback=wiliCallback";$.ajax({url:e,dataType:"jsonp",success:function(e){var n,o=e[1];if(o.length>0){var i=e[3],r=e[2];n='<div class="card info-window"><div class="card-block"><h5 class="card-title">'+a.name+'</h5><p class="card-text">'+r+'</p><div>This content is based on a Wikipedia article: <a href="'+i[0]+'" target="_blank">here</a></div></div></div>'}else n='<div class="card info-window"><div class="card-block"><h5 class="card-title">'+a.name+'</h5><p class="card-text">Wikipedia content not found</p></div></div>';infoWindow.setContent(n),infoWindow.open(map,a.marker)}})}function initMap(){var a=new google.maps.Map(document.getElementById("map"),{scrollwheel:!1,zoom:14});infoWindow=new google.maps.InfoWindow;var e=new google.maps.Geocoder;places.forEach(function(n){pinAddress(e,a,n)}),ko.applyBindings(new ViewModel)}function pinAddress(a,e,n){var o=n.address;a.geocode({address:o},function(a,o){if("OK"===o){var i="/img/Thailand-icon.png";e.setCenter(a[0].geometry.location),n.marker=new google.maps.Marker({map:e,icon:i,animation:google.maps.Animation.DROP,position:a[0].geometry.location}),google.maps.event.addListener(n.marker,"click",function(){getWikiInfo(n),toggleBounce(n.marker)}),markers.push({name:n.name,marker:n.marker})}else alert("Geocode was not successful for the following reason: "+o)})}function toggleBounce(a){null!==a.getAnimation()?a.setAnimation(null):(a.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){a.setAnimation(null)},1400))}function clickedMarker(a){markers.forEach(function(e){e.name==a&&google.maps.event.trigger(e.marker,"click")})}var markers=[],infoWindow,places=[{name:"Wat Pra Kaeow",address:"Na Phra Lan Rd, Phra Nakhon, Bangkok, Khwaeng Phra Borom Maha Ratchawang, Khet Phra Nakhon, Krung Thep Maha Nakhon 10200, Thailand"},{name:"Bangkok National Museum",address:"4 Chao Fa Rd, Chana Songkhram, Khet Phra Nakhon, Krung Thep Maha Nakhon 10200, Thailand"},{name:"Jim Thompson House",address:"Rama I Rd, Khwaeng Wang Mai, Khet Pathum Wan, Krung Thep Maha Nakhon 10330, Thailand"},{name:"Phra Pin Klao Bridge",address:"Khwaeng Chana Songkhram, Khet Phra Nakhon, Krung Thep Maha Nakhon 10200, Thailand"},{name:"Museum Siam",address:"Thanon Sanam Chai, Khwaeng Phra Borom Maha Ratchawang, Khet Phra Nakhon, Krung Thep Maha Nakhon 10200, Thailand"},{name:"Thammasat University (Tha Prachan Campus)",address:"12 Prachan Road Khwaeng Phra Borom Maha Ratchawang, Khet Phra Nakhon, Krung Thep Maha Nakhon 10200, Thailand"}],ViewModel=function(){var a=this;this.filter=ko.observable(""),this.filteredPlaces=ko.computed(function(){var e=a.filter().toLowerCase();return e?ko.utils.arrayFilter(places,function(a){var n=a.name.toLowerCase().indexOf(e)!==-1;return n?a.marker.setVisible(!0):a.marker.setVisible(!1),n}):(places.forEach(function(a){a.marker&&a.marker.setVisible(!0)}),places)})};